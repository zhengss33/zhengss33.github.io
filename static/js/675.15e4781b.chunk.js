"use strict";(self.webpackChunktask_manager=self.webpackChunktask_manager||[]).push([[675],{2675:function(n,e,t){t.r(e),t.d(e,{default:function(){return et}});var r,i,o,a=t(168),u=t(9958),d=t(1457),c=t(9439),l=t(1413),s=t(5987),f=t(6896),p=t(6574),x=t(7382),h=t(6090),v=t(7892),m=t.n(v),Z=t(3504),j=t(7561),C=t(184),g=["checked","onCheckedChange"],k=function(n){var e=n.checked,t=n.onCheckedChange,r=(0,s.Z)(n,g);return(0,C.jsx)(j.Z,(0,l.Z)({count:1,value:e?1:0,onChange:function(n){return null===t||void 0===t?void 0:t(!!n)}},r))},y=t(286),b=t(1933),L=t(3433),I=t(4165),w=t(5861),M=function(n){var e=n.fromId,t=n.type,r=n.referenceId,i=n.list,o=(0,L.Z)(i),a=o.findIndex((function(n){return n.id===e}));if(!r)return O((0,L.Z)(o),a,o.length-1);var u=o.findIndex((function(n){return n.id===r}));return("after"===t?O:E)((0,L.Z)(o),a,u)},E=function(n,e,t){var r=n[t],i=n.splice(e,1)[0],o=n.indexOf(r);return n.splice(o,0,i),n},O=function(n,e,t){var r=n[t],i=n.splice(e,1)[0],o=n.indexOf(r);return n.splice(o+1,0,i),n},T=function(n,e){var t=(0,b.useQueryClient)();return{onSuccess:function(){return t.invalidateQueries(n)},onMutate:function(){var r=(0,w.Z)((0,I.Z)().mark((function r(i){var o;return(0,I.Z)().wrap((function(r){for(;;)switch(r.prev=r.next){case 0:return r.next=2,t.cancelQueries(n);case 2:return o=t.getQueryData(n),t.setQueryData(n,(function(n){return e(i,n)})),r.abrupt("return",{previousItems:o});case 5:case"end":return r.stop()}}),r)})));return function(n){return r.apply(this,arguments)}}(),onError:function(e,r,i){null!==i&&void 0!==i&&i.previousItems&&t.setQueryData(n,i.previousItems)},onSettled:function(){}}},P=function(n){return T(n,(function(n,e){return(null===e||void 0===e?void 0:e.filter((function(e){return e.id!==n.id})))||[]}))},N=function(n){return T(n,(function(n,e){return(null===e||void 0===e?void 0:e.map((function(e){return e.id===n.id?(0,l.Z)((0,l.Z)({},e),n):e})))||[]}))},S=function(n){return T(n,(function(n,e){return e?[].concat((0,L.Z)(e),[n]):[]}))},F=function(n){var e=(0,y.i)();return(0,b.useQuery)(["projects",n],(function(){return e("projects",{data:n})}))},D=function(n){var e=(0,y.i)();return(0,b.useMutation)((function(n){return e("projects/".concat(n.id),{method:"PATCH",data:n})}),N(n))},z=function(n){var e=(0,y.i)();return(0,b.useMutation)((function(n){return e("projects",{method:"POST",data:n})}),S(n))},R=function(n){var e=(0,y.i)();return(0,b.useQuery)(["project",n],(function(){return e("projects/".concat(n))}),{enabled:!!n})},Q=t(5728),A=t(2791),Y=function(n){if(!n)return{};var e=(0,l.Z)({},n);return Object.keys(e).forEach((function(n){(function(n){return void 0===n||null===n||""===n})(e[n])&&delete e[n]})),e},W=function(){return window.location.href=window.location.origin},V=t(4942),H=function(n){var e=(0,Z.lr)(),t=(0,c.Z)(e,2),r=t[0],i=t[1];return[(0,A.useMemo)((function(){return n.reduce((function(n,e){return r.has(e)?(0,l.Z)((0,l.Z)({},n),(0,V.Z)({},e,r.get(e))):n}),{})}),[r]),function(n){var e=Y((0,l.Z)((0,l.Z)({},Object.fromEntries(r)),n));i(e)}]},K=function(){var n=H(["name","personId"]),e=(0,c.Z)(n,2),t=e[0],r=e[1];return[(0,A.useMemo)((function(){return Y((0,l.Z)((0,l.Z)({},t),{},{personId:Number(t.personId)||void 0}))}),[t]),r]},U=function(){var n=K();return["projects",(0,c.Z)(n,1)[0]]},q=function(){var n=H(["isCreate","id"]),e=(0,c.Z)(n,2),t=e[0],r=e[1],i=R(Number(t.id)),o=i.data,a=i.isFetching;return{projectModelOpen:"true"===t.isCreate||!!t.id,open:function(){return r((0,l.Z)((0,l.Z)({},t),{},{isCreate:!0}))},close:function(){return r((0,l.Z)((0,l.Z)({},t),{},{isCreate:void 0,id:void 0}))},startEdit:function(n){return r((0,l.Z)((0,l.Z)({},t),{},{id:n}))},editingProjectData:o,isFetching:a}},B=["users"],_=function(n){var e=n.users,t=(0,s.Z)(n,B),r=D(U()).mutate,i=function(n){return function(e){return r({id:n,pin:e})}},o=[{title:(0,C.jsx)(k,{checked:!0,disabled:!0}),render:function(n){var e=n.id,t=n.pin;return(0,C.jsx)(k,{checked:t,onCheckedChange:i(e)})}},{title:"\u540d\u79f0",dataIndex:"name",key:"name",sorter:function(n,e){return n.name.localeCompare(e.name)},render:function(n,e){return(0,C.jsx)(Z.rU,{to:String(e.id),children:n})}},{title:"\u90e8\u95e8",dataIndex:"organization",key:"organization"},{title:"\u8d1f\u8d23\u4eba",dataIndex:"personId",key:"personId",render:function(n){var t;return(null===(t=e.find((function(e){return e.id===n})))||void 0===t?void 0:t.name)||"unknown"}},{title:"\u521b\u5efa\u65f6\u95f4",dataIndex:"created",key:"created",render:function(n){return n?m()(n).format("YYYY-MM-DD"):"\u65e0"}},{render:function(n){return(0,C.jsx)(X,{project:n})}}];return(0,C.jsx)(f.Z,(0,l.Z)({rowKey:"id",pagination:!1,columns:o},t))},X=function(n){var e,t=n.project,r=q().startEdit,i=function(n){var e=(0,y.i)();return(0,b.useMutation)((function(n){var t=n.id;return e("projects/".concat(t),{method:"DELETE"})}),P(n))}(U()),o=i.mutate,a=[{label:"\u7f16\u8f91",key:"edit",onClick:(e=t.id,function(){return r(e)})},{label:"\u5220\u9664",key:"delete",onClick:function(){return function(n){p.Z.confirm({title:"\u786e\u5b9a\u5220\u9664\u8fd9\u4e2a\u9879\u76ee\u5417\uff1f",content:"\u70b9\u51fb\u786e\u5b9a\u5220\u9664",okText:"\u786e\u5b9a",cancelText:"\u53d6\u6d88",onOk:function(){o({id:n})}})}(t.id)}}];return(0,C.jsx)(x.Z,{overlay:(0,C.jsx)(h.Z,{items:a}),children:(0,C.jsx)(Q.zL,{type:"link",children:"..."})})},G=t(4941),J=t(6005),$=function(n){var e=(0,y.i)();return(0,b.useQuery)(["users",n],(function(){return e("users",{data:n})}))},nn=t(7273),en=["value","onChange","defaultOptionName","options"],tn=function(n){var e=n.value,t=n.onChange,r=n.defaultOptionName,i=n.options,o=(0,s.Z)(n,en),a=nn.Z.Option;return(0,C.jsxs)(nn.Z,(0,l.Z)((0,l.Z)({value:null!==i&&void 0!==i&&i.length?rn(e):0,onChange:function(n){return null===t||void 0===t?void 0:t(rn(n))}},o),{},{children:[r?(0,C.jsx)(a,{value:0,children:r}):null,null===i||void 0===i?void 0:i.map((function(n){return(0,C.jsx)(a,{value:n.id,children:n.name},n.id)}))]}))},rn=function(n){return isNaN(Number(n))?0:Number(n)},on=function(n){var e=$().data;return(0,C.jsx)(tn,(0,l.Z)({options:e},n))},an=t(4923),un=function(n){var e=n.param,t=n.setParam;return(0,an.BX)(G.Z,{css:{marginBottom:"2rem"},layout:"inline",children:[(0,an.tZ)(G.Z.Item,{children:(0,an.tZ)(J.Z,{placeholder:"\u9879\u76ee\u540d\u79f0",type:"text",value:e.name,onChange:function(n){t((0,l.Z)((0,l.Z)({},e),{},{name:n.target.value}))}})}),(0,an.tZ)(G.Z.Item,{children:(0,an.tZ)(on,{defaultOptionName:"\u8d1f\u8d23\u4eba",value:e.personId,onChange:function(n){t((0,l.Z)((0,l.Z)({},e),{},{personId:n}))}})})]})},dn=t(1313),cn=function(n){var e=!(arguments.length>1&&void 0!==arguments[1])||arguments[1],t=(0,A.useRef)(document.title).current;(0,A.useEffect)((function(){document.title=n}),[n]),(0,A.useEffect)((function(){return function(){e||(document.title=t)}}),[t,e])},ln=function(){var n=K(),e=(0,c.Z)(n,2),t=e[0],r=e[1],i=F((0,dn.Nr)(t,300)),o=i.isLoading,a=i.error,u=i.data,d=$().data,l=void 0===d?[]:d,s=q().open;return cn("\u9879\u76ee\u5217\u8868",!1),(0,C.jsxs)(sn,{children:[(0,C.jsxs)(Q.at,{between:!0,children:[(0,C.jsx)("h2",{children:"\u9879\u76ee\u5217\u8868"}),(0,C.jsx)(Q.zL,{type:"link",onClick:s,children:"\u521b\u5efa\u9879\u76ee"})]}),(0,C.jsx)(un,{param:t,setParam:r}),(0,C.jsx)(Q.Tv,{error:a}),(0,C.jsx)(_,{dataSource:u||[],users:l,loading:o})]})},sn=u.Z.div(r||(r=(0,a.Z)(["\n  padding: 3.2rem\n"]))),fn=["title","titleId"];function pn(){return pn=Object.assign?Object.assign.bind():function(n){for(var e=1;e<arguments.length;e++){var t=arguments[e];for(var r in t)Object.prototype.hasOwnProperty.call(t,r)&&(n[r]=t[r])}return n},pn.apply(this,arguments)}function xn(n,e){if(null==n)return{};var t,r,i=function(n,e){if(null==n)return{};var t,r,i={},o=Object.keys(n);for(r=0;r<o.length;r++)t=o[r],e.indexOf(t)>=0||(i[t]=n[t]);return i}(n,e);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(n);for(r=0;r<o.length;r++)t=o[r],e.indexOf(t)>=0||Object.prototype.propertyIsEnumerable.call(n,t)&&(i[t]=n[t])}return i}function hn(n,e){var t=n.title,r=n.titleId,a=xn(n,fn);return A.createElement("svg",pn({viewBox:"0 0 179 32",xmlns:"http://www.w3.org/2000/svg",focusable:"false","aria-hidden":"true",className:"css-sq9aeg-Logo",ref:e,"aria-labelledby":r},a),t?A.createElement("title",{id:r},t):null,i||(i=A.createElement("defs",null,A.createElement("linearGradient",{x1:"97.6553341%",y1:"35.6591143%",x2:"37.202032%",y2:"75.4891864%",id:"uid392-1"},A.createElement("stop",{stopColor:"#0052CC",offset:"7%"}),A.createElement("stop",{stopColor:"#2684FF",offset:"100%"})),A.createElement("linearGradient",{x1:"8.43371138%",y1:"60.1495759%",x2:"64.1161517%",y2:"23.5790285%",id:"uid392-2"},A.createElement("stop",{stopColor:"#0052CC",offset:"0%"}),A.createElement("stop",{stopColor:"#2684FF",offset:"100%"})))),o||(o=A.createElement("g",{stroke:"none",strokeWidth:1,fillRule:"nonzero"},A.createElement("path",{d:"M11.3881081,27.9242105 C12.4881804,26.8071817 13.1062496,25.2917664 13.1062496,23.7115789 C13.1062496,22.1313915 12.4881804,20.6159762 11.3881081,19.4989474 L11.3881081,19.4989474 L3.74837838,11.7621053 L0.273513514,15.2926316 C-0.0900771727,15.6625064 -0.0900771727,16.2617042 0.273513514,16.6315789 L11.3881081,27.9242105 L11.3881081,27.9242105 Z",fill:"currentColor",fillRule:"nonzero"}),A.createElement("path",{d:"M22.5027027,15.2926316 L11.3881081,4 L11.3881081,4 L11.3539189,4.03473684 L11.3539189,4.03473684 C9.08852466,6.36456187 9.09963243,10.1156459 11.3787838,12.4315789 L19.0247297,20.1652632 L22.5027027,16.6315789 C22.8662934,16.2617042 22.8662934,15.6625064 22.5027027,15.2926316 Z",fill:"currentColor",fillRule:"nonzero"}),A.createElement("path",{d:"M11.3881081,12.4252632 C9.10895676,10.1093301 9.09784899,6.35824608 11.3632432,4.02842105 L3.43445946,12.0810526 L7.58067568,16.2936842 L11.3881081,12.4252632 Z",fill:"url(#uid392-1)",fillRule:"nonzero"}),A.createElement("path",{d:"M15.1893243,15.6368421 L11.3881081,19.4989474 C12.4881804,20.6159762 13.1062496,22.1313915 13.1062496,23.7115789 C13.1062496,25.2917664 12.4881804,26.8071817 11.3881081,27.9242105 L19.3355405,19.8494737 L15.1893243,15.6368421 Z",fill:"url(#uid392-2)",fillRule:"nonzero"}),A.createElement("path",{d:"M36.07,18.956 C36.07,20.646 35.394,21.842 33.418,21.842 C32.56,21.842 31.702,21.686 31,21.4 L31,23.662 C31.65,23.896 32.586,24.104 33.808,24.104 C37.032,24.104 38.41,21.946 38.41,18.8 L38.41,6.918 L36.07,6.918 L36.07,18.956 Z M41.894,7.568 C41.894,8.556 42.544,9.128 43.454,9.128 C44.364,9.128 45.014,8.556 45.014,7.568 C45.014,6.58 44.364,6.008 43.454,6.008 C42.544,6.008 41.894,6.58 41.894,7.568 Z M42.31,24 L44.546,24 L44.546,11 L42.31,11 L42.31,24 Z M47.926,24 L50.11,24 L50.11,16.33 C50.11,13.574 51.852,12.716 54.712,13.002 L54.712,10.818 C52.164,10.662 50.864,11.754 50.11,13.288 L50.11,11 L47.926,11 L47.926,24 Z M65.45,24 L65.45,21.66 C64.618,23.376 63.058,24.26 61.056,24.26 C57.598,24.26 55.856,21.322 55.856,17.5 C55.856,13.834 57.676,10.74 61.316,10.74 C63.214,10.74 64.67,11.598 65.45,13.288 L65.45,11 L67.686,11 L67.686,24 L65.45,24 Z M58.092,17.5 C58.092,20.62 59.34,22.18 61.654,22.18 C63.656,22.18 65.45,20.906 65.45,18.02 L65.45,16.98 C65.45,14.094 63.812,12.82 61.914,12.82 C59.392,12.82 58.092,14.484 58.092,17.5 Z M86.926,19.294 C86.926,16.226 84.898,15.056 81.284,14.146 C78.268,13.392 77.176,12.69 77.176,11.286 C77.176,9.726 78.502,8.946 80.738,8.946 C82.506,8.946 84.352,9.258 86.068,10.246 L86.068,7.906 C84.898,7.256 83.312,6.658 80.842,6.658 C76.864,6.658 74.836,8.634 74.836,11.286 C74.836,14.094 76.552,15.42 80.4,16.356 C83.65,17.136 84.586,17.942 84.586,19.45 C84.586,20.958 83.624,21.972 81.05,21.972 C78.788,21.972 76.344,21.374 74.758,20.542 L74.758,22.934 C76.084,23.61 77.618,24.26 80.92,24.26 C85.158,24.26 86.926,22.258 86.926,19.294 Z M95.09,24.26 C91.19,24.26 88.902,21.374 88.902,17.474 C88.902,13.574 91.19,10.74 95.09,10.74 C98.964,10.74 101.226,13.574 101.226,17.474 C101.226,21.374 98.964,24.26 95.09,24.26 Z M95.09,12.82 C92.308,12.82 91.086,15.004 91.086,17.474 C91.086,19.944 92.308,22.18 95.09,22.18 C97.846,22.18 99.042,19.944 99.042,17.474 C99.042,15.004 97.846,12.82 95.09,12.82 Z M106.92,9.622 C106.92,8.452 107.596,7.646 108.974,7.646 C109.494,7.646 109.988,7.698 110.378,7.776 L110.378,5.722 C109.988,5.618 109.546,5.514 108.87,5.514 C106.088,5.514 104.736,7.152 104.736,9.57 L104.736,11 L102.63,11 L102.63,13.08 L104.736,13.08 L104.736,24 L106.92,24 L106.92,13.08 L110.274,13.08 L110.274,11 L106.92,11 L106.92,9.622 Z M115.786,19.892 L115.786,13.08 L119.244,13.08 L119.244,11 L115.786,11 L115.786,8.244 L113.602,8.244 L113.602,11 L111.496,11 L111.496,13.08 L113.602,13.08 L113.602,19.944 C113.602,22.362 114.954,24 117.736,24 C118.412,24 118.854,23.896 119.244,23.792 L119.244,21.634 C118.854,21.712 118.36,21.816 117.84,21.816 C116.462,21.816 115.786,21.036 115.786,19.892 Z M125.432,24 L128.292,24 L130.528,17.708 L131.724,13.704 L132.92,17.708 L135.156,24 L138.016,24 L142.8,11 L140.33,11 L136.586,22.024 L132.79,11 L130.658,11 L126.862,22.024 L123.118,11 L120.648,11 L125.432,24 Z M153.538,24 L153.538,21.66 C152.706,23.376 151.146,24.26 149.144,24.26 C145.686,24.26 143.944,21.322 143.944,17.5 C143.944,13.834 145.764,10.74 149.404,10.74 C151.302,10.74 152.758,11.598 153.538,13.288 L153.538,11 L155.774,11 L155.774,24 L153.538,24 Z M146.18,17.5 C146.18,20.62 147.428,22.18 149.742,22.18 C151.744,22.18 153.538,20.906 153.538,18.02 L153.538,16.98 C153.538,14.094 151.9,12.82 150.002,12.82 C147.48,12.82 146.18,14.484 146.18,17.5 Z M159.154,24 L161.338,24 L161.338,16.33 C161.338,13.574 163.08,12.716 165.94,13.002 L165.94,10.818 C163.392,10.662 162.092,11.754 161.338,13.288 L161.338,11 L159.154,11 L159.154,24 Z M178.108,23.48 C177.042,24.052 175.404,24.26 174.078,24.26 C169.216,24.26 167.084,21.452 167.084,17.474 C167.084,13.548 169.268,10.74 173.22,10.74 C177.224,10.74 178.836,13.522 178.836,17.474 L178.836,18.488 L169.346,18.488 C169.658,20.698 171.088,22.128 174.156,22.128 C175.664,22.128 176.938,21.842 178.108,21.426 L178.108,23.48 Z M173.116,12.768 C170.75,12.768 169.554,14.302 169.32,16.564 L176.574,16.564 C176.444,14.146 175.352,12.768 173.116,12.768 Z",fill:"inherit",fillRule:"evenodd"}))))}var vn,mn,Zn,jn,Cn,gn,kn,yn,bn,Ln,In,wn,Mn,En,On,Tn,Pn,Nn,Sn,Fn=A.forwardRef(hn),Dn=(t.p,t(7309)),zn=t(6871),Rn=t(541),Qn=function(n){var e=(0,y.i)();return(0,b.useQuery)(["kanbans",n],(function(){return e("kanbans",{data:n})}))},An=function(n){var e=(0,y.i)();return(0,b.useMutation)((function(n){return e("kanbans/reorder",{method:"POST",data:n})}),function(n){return T(n,(function(n,e){return M((0,l.Z)({list:e},n))}))}(n))},Yn=function(n){var e=(0,y.i)();return(0,b.useQuery)(["tasks",n],(function(){return e("tasks",{data:n})}))},Wn=function(n){var e=(0,y.i)();return(0,b.useMutation)((function(n){return e("tasks/reorder",{method:"POST",data:n})}),function(n){return T(n,(function(n,e){return M((0,l.Z)({list:e},n)).map((function(e){return e.id===n.fromId?(0,l.Z)((0,l.Z)({},e),{},{kanbanId:n.toKanbanId}):e}))}))}(n))},Vn=function(){var n,e=null===(n=(0,zn.TH)().pathname.match(/projects\/(\d+)/))||void 0===n?void 0:n[1];return Number(e)},Hn=function(){return R(Vn())},Kn=function(){return{projectId:Vn()}},Un=function(){return["kanbans",Kn()]},qn=function(){var n=Vn(),e=H(["name","typeId","processorId","tagId"]),t=(0,c.Z)(e,2),r=t[0],i=t[1];return[(0,A.useMemo)((function(){return{projectId:n,processorId:Number(r.processorId)||void 0,typeId:Number(r.typeId)||void 0,tagId:Number(r.tagId)||void 0,name:r.name}}),[n,r]),i]},Bn=function(){return["tasks",qn()[0]]},_n=function(){var n=H(["editingTaskId"]),e=(0,c.Z)(n,2),t=e[0].editingTaskId,r=e[1],i=function(n){var e=(0,y.i)();return(0,b.useQuery)(["task",n],(function(){return e("tasks/".concat(n))}),{enabled:!!n})}(Number(t)),o=i.isLoading;return{isOpen:!!t,editingTaskId:t,editingTaskData:i.data,isLoading:o,startEdit:(0,A.useCallback)((function(n){return r({editingTaskId:n})}),[r]),close:(0,A.useCallback)((function(){return r({editingTaskId:void 0})}),[r])}},Xn=t(5564),Gn=t(490),Jn=function(){var n=(0,y.i)();return(0,b.useQuery)(["taskTypes"],(function(){return n("taskTypes")}))},$n=t(3099),ne=t(3343),ee=t(9286),te=t(6106),re=function(n){var e=n.kanbanId,t=(0,A.useState)(""),r=(0,c.Z)(t,2),i=r[0],o=r[1],a=function(n){var e=(0,y.i)();return(0,b.useMutation)((function(n){return e("tasks",{method:"POST",data:n})}),S(n))}(Bn()).mutateAsync,u=Vn(),d=(0,A.useState)(!1),l=(0,c.Z)(d,2),s=l[0],f=l[1],p=function(){var n=(0,w.Z)((0,I.Z)().mark((function n(){return(0,I.Z)().wrap((function(n){for(;;)switch(n.prev=n.next){case 0:return n.next=2,a({name:i,projectId:u,kanbanId:e});case 2:o(""),f(!1);case 4:case"end":return n.stop()}}),n)})));return function(){return n.apply(this,arguments)}}(),x=function(){return f((function(n){return!n}))};return(0,A.useEffect)((function(){s||o("")}),[s]),s?(0,C.jsx)(ne.Z,{children:(0,C.jsx)(J.Z,{value:i,onChange:function(n){return o(n.target.value)},placeholder:"\u6dfb\u52a0\u4efb\u52a1",maxLength:10,autoFocus:!0,onBlur:x,onPressEnter:p})}):(0,C.jsx)(ie,{children:(0,C.jsx)(te.Z,{title:"\u521b\u5efa\u4efb\u52a1",children:(0,C.jsx)(oe,{type:"primary",shape:"circle",icon:(0,C.jsx)(ee.Z,{}),onClick:x})})})},ie=u.Z.div(vn||(vn=(0,a.Z)(["\n  position: absolute;\n  bottom: 10px;\n  right: 10px;\n"]))),oe=(0,u.Z)(Dn.Z)(mn||(mn=(0,a.Z)(["\n  box-shadow: 0 3px 6px -4px #0000001f, 0 6px 16px #00000014, 0 9px 28px 8px #0000000d;  \n"]))),ae=t(2376),ue=function(n){var e=n.text,t=n.keyword;if(!t)return(0,C.jsx)(C.Fragment,{children:e});var r=e.split(t);return(0,C.jsx)(C.Fragment,{children:r.map((function(n,e){return(0,C.jsxs)("span",{children:[n,e===r.length-1?null:(0,C.jsx)(ae.Z.Text,{mark:!0,children:t})]},e)}))})},de=t(2464),ce=t(866),le=["children"],se=["children"],fe=["children"],pe=function(n){var e=n.children,t=(0,s.Z)(n,le);return(0,C.jsx)(ce.bK,(0,l.Z)((0,l.Z)({},t),{},{children:function(n){return A.isValidElement(e)?A.cloneElement(e,(0,l.Z)((0,l.Z)({},n.droppableProps),{},{ref:n.innerRef,provided:n})):(0,C.jsx)("div",{})}}))},xe=A.forwardRef((function(n,e){var t,r=n.children,i=(0,s.Z)(n,se);return(0,C.jsxs)("div",(0,l.Z)((0,l.Z)({ref:e},i),{},{children:[r,null===(t=i.provided)||void 0===t?void 0:t.placeholder]}))})),he=function(n){var e=n.children,t=(0,s.Z)(n,fe);return(0,C.jsx)(ce._l,(0,l.Z)((0,l.Z)({},t),{},{children:function(n){return A.isValidElement(e)?A.cloneElement(e,(0,l.Z)((0,l.Z)((0,l.Z)({},n.draggableProps),n.dragHandleProps),{},{ref:n.innerRef})):(0,C.jsx)("div",{})}}))},ve=["kanban","allTasks"],me=A.forwardRef((function(n,e){var t=n.kanban,r=n.allTasks,i=(0,s.Z)(n,ve),o=null===r||void 0===r?void 0:r.filter((function(n){return n.kanbanId===t.id}));return(0,C.jsxs)(ge,(0,l.Z)((0,l.Z)({},i),{},{ref:e,hoverable:!0,title:t.name,size:"small",headStyle:{backgroundColor:"#1890ff",color:"#fff"},bodyStyle:{flex:1,overflowX:"scroll"},extra:(0,C.jsx)(Ce,{kanban:t},t.id),children:[(0,C.jsx)(ke,{children:(0,C.jsx)(pe,{type:"ROW",direction:"vertical",droppableId:String(t.id),children:(0,C.jsx)(xe,{style:{minHeight:"5px"},children:null===o||void 0===o?void 0:o.map((function(n,e){return(0,C.jsx)(he,{index:e,draggableId:String(n.id),children:(0,C.jsx)("div",{children:(0,C.jsx)(je,{task:n},n.id)})},n.id)}))})})}),(0,C.jsx)(re,{kanbanId:t.id}),(0,C.jsx)(re,{kanbanId:t.id})]}))})),Ze=function(n){var e,t=n.id,r=Jn().data,i=null===r||void 0===r||null===(e=r.find((function(n){return n.id===t})))||void 0===e?void 0:e.name;if(!i)return null;var o=(0,C.jsx)(Xn.Z,{twoToneColor:"#eb2f96"}),a=(0,C.jsx)(Gn.Z,{});return"task"===i?a:o},je=function(n){var e=n.task,t=_n().startEdit,r=qn(),i=(0,c.Z)(r,1)[0].name,o=function(n){var e=(0,y.i)();return(0,b.useMutation)((function(n){var t=n.id;return e("tasks/".concat(t),{method:"DELETE"})}),P(n))}(Bn()).mutate;return(0,C.jsxs)(ye,{bodyStyle:{display:"flex",alignItems:"center",justifyContent:"space-between"},children:[(0,C.jsx)(be,{onClick:function(){return t(e.id)},children:(0,C.jsxs)($n.Z,{children:[(0,C.jsx)(Ze,{id:e.typeId}),(0,C.jsx)(ue,{text:e.name,keyword:i}),"id: "+e.id]})}),(0,C.jsx)(de.Z,{onClick:function(n){n.stopPropagation(),p.Z.confirm({title:"\u786e\u5b9a\u5220\u9664\u8be5\u4efb\u52a1?",okText:"\u786e\u5b9a",cancelText:"\u53d6\u6d88",onOk:function(){o({id:e.id})}})}})]},e.id)},Ce=function(n){var e=n.kanban,t=function(n){var e=(0,y.i)();return(0,b.useMutation)((function(n){var t=n.id;return e("kanbans/".concat(t),{method:"DELETE"})}),P(n))}(Un()).mutate,r=[{label:(0,C.jsx)(Dn.Z,{type:"link",onClick:function(){p.Z.confirm({title:"\u786e\u5b9a\u5220\u9664\u8be5\u770b\u677f?",okText:"\u786e\u5b9a",cancelText:"\u53d6\u6d88",onOk:function(){t({id:e.id})}})},children:"\u5220\u9664"}),key:"delete"}];return(0,C.jsx)(x.Z,{overlay:(0,C.jsx)(h.Z,{items:r}),children:(0,C.jsx)(Dn.Z,{type:"link",children:"..."})})},ge=(0,u.Z)(ne.Z)(Zn||(Zn=(0,a.Z)(["\n  min-width: 28rem;\n  position: relative;\n  margin-right: 1.5rem;\n  display: flex;\n  flex-direction: column;\n  border-radius: 5px;\n"]))),ke=u.Z.div(jn||(jn=(0,a.Z)(["\n  flex: 1;\n  overflow: scroll;\n\n  ::-webkit-scrollbar {\n    display: none;\n  }\n"]))),ye=(0,u.Z)(ne.Z)(Cn||(Cn=(0,a.Z)(["\n  margin-bottom: 0.5rem;\n  cursor: pointer;\n"]))),be=u.Z.div(gn||(gn=(0,a.Z)(["\n  flex: 1;\n"]))),Le=function(){var n=(0,A.useState)(""),e=(0,c.Z)(n,2),t=e[0],r=e[1],i=Vn(),o=function(n){var e=(0,y.i)();return(0,b.useMutation)((function(n){return e("kanbans",{method:"POST",data:n})}),S(n))}(Un()).mutateAsync,a=function(){var n=(0,w.Z)((0,I.Z)().mark((function n(){return(0,I.Z)().wrap((function(n){for(;;)switch(n.prev=n.next){case 0:return n.next=2,o({name:t,projectId:i});case 2:r("");case 3:case"end":return n.stop()}}),n)})));return function(){return n.apply(this,arguments)}}();return(0,C.jsx)(ge,{children:(0,C.jsx)(J.Z,{placeholder:"\u65b0\u5efa\u770b\u677f",size:"large",value:t,onChange:function(n){return r(n.target.value)},onPressEnter:a})})},Ie=function(n){var e=Jn().data;return(0,C.jsx)(tn,(0,l.Z)({options:e},n))},we=function(){var n=qn(),e=(0,c.Z)(n,2),t=e[0],r=e[1];return(0,C.jsxs)(Q.at,{marginBottom:3,gap:!0,children:[(0,C.jsx)(J.Z,{style:{width:"20rem"},placeholder:"\u4efb\u52a1\u540d",value:t.name,onChange:function(n){return r({name:n.target.value})}}),(0,C.jsx)(on,{defaultOptionName:"\u7ecf\u529e\u4eba",value:t.processorId,onChange:function(n){return r({processorId:n})}}),(0,C.jsx)(Ie,{defaultOptionName:"\u7c7b\u578b",value:t.typeId,onChange:function(n){return r({typeId:n})}}),(0,C.jsx)(Dn.Z,{onClick:function(){r({name:void 0,typeId:void 0,processorId:void 0,tagId:void 0})},children:"\u6e05\u9664\u7b5b\u9009\u5668"})]})},Me=t(8139),Ee=function(){var n=_n(),e=n.editingTaskData,t=n.close,r=n.isOpen,i=(0,Me.cI)(),o=(0,c.Z)(i,1)[0],a=function(n){var e=(0,y.i)();return(0,b.useMutation)((function(n){return e("tasks/".concat(n.id),{method:"PATCH",data:n})}),N(n))}(Bn()),u=a.mutateAsync,d=a.isLoading,s=function(){var n=(0,w.Z)((0,I.Z)().mark((function n(){return(0,I.Z)().wrap((function(n){for(;;)switch(n.prev=n.next){case 0:return n.next=2,u((0,l.Z)((0,l.Z)({},e),o.getFieldsValue()));case 2:t();case 3:case"end":return n.stop()}}),n)})));return function(){return n.apply(this,arguments)}}();return(0,A.useEffect)((function(){o.setFieldsValue(e)}),[e,o]),(0,C.jsx)(p.Z,{onOk:s,onCancel:function(){t(),o.resetFields()},okText:"\u786e\u8ba4",cancelText:"\u53d6\u6d88",title:"\u7f16\u8f91\u4efb\u52a1",confirmLoading:d,visible:r,forceRender:!0,children:(0,C.jsxs)(G.Z,(0,l.Z)((0,l.Z)({},Oe),{},{initialValues:e,form:o,children:[(0,C.jsx)(G.Z.Item,{rules:[{required:!0,message:"\u8bf7\u8f93\u5165\u4efb\u52a1\u540d"}],label:"\u4efb\u52a1\u540d",name:"name",children:(0,C.jsx)(J.Z,{placeholder:"\u4efb\u52a1\u540d"})}),(0,C.jsx)(G.Z.Item,{label:"\u7ecf\u529e\u4eba",name:"processorId",children:(0,C.jsx)(on,{defaultOptionName:"\u7ecf\u529e\u4eba"})}),(0,C.jsx)(G.Z.Item,{label:"\u7c7b\u578b",name:"typeId",children:(0,C.jsx)(Ie,{defaultOptionName:"\u7c7b\u578b"})})]}))})},Oe={labelCol:{span:8},wrapperCol:{span:16}},Te=function(){var n=Qn(Kn()),e=n.data,t=n.isLoading,r=qn(),i=(0,c.Z)(r,1)[0],o=Yn((0,dn.Nr)(i,200)),a=o.isLoading,u=o.data,d=t||a,l=Hn().data,s=function(){var n=Qn(Kn()).data,e=An(Un()).mutate,t=Yn(qn()[0]).data,r=void 0===t?[]:t,i=Wn(Bn()).mutate;return(0,A.useCallback)((function(t){var o=t.source,a=t.destination,u=t.type;if(a){if("COLUMN"===u){var d=null===n||void 0===n?void 0:n[o.index].id,c=null===n||void 0===n?void 0:n[a.index].id;if(!d||!c||d===c)return;var l=a.index>o.index?"after":"before";e({fromId:d,referenceId:c,type:l})}if("ROW"===u){var s=+o.droppableId,f=+a.droppableId,p=null===r||void 0===r?void 0:r.filter((function(n){return n.kanbanId===s}))[o.index],x=null===r||void 0===r?void 0:r.filter((function(n){return n.kanbanId===f}))[a.index];if((null===p||void 0===p?void 0:p.id)===(null===x||void 0===x?void 0:x.id))return;i({fromId:null===p||void 0===p?void 0:p.id,referenceId:null===x||void 0===x?void 0:x.id,type:a.index>o.index?"after":"before",fromKanbanId:s,toKanbanId:f})}}}),[n,e,r,i])}();return cn("\u770b\u677f\u5217\u8868"),(0,C.jsx)(ce.Z5,{onDragEnd:s,children:(0,C.jsxs)(Q.X_,{children:[(0,C.jsxs)("h1",{children:[null===l||void 0===l?void 0:l.name,"\u770b\u677f"]}),(0,C.jsx)(we,{}),d?(0,C.jsx)(Rn.Z,{size:"large"}):(0,C.jsxs)(Pe,{children:[(0,C.jsx)(pe,{type:"COLUMN",direction:"horizontal",droppableId:"kanban",children:(0,C.jsx)(xe,{style:{display:"flex"},children:null===e||void 0===e?void 0:e.map((function(n,e){return(0,C.jsx)(he,{draggableId:"kanban"+n.id,index:e,children:(0,C.jsx)(me,{kanban:n,allTasks:u||[]},n.id)},n.id)}))})}),(0,C.jsx)(Le,{})]}),(0,C.jsx)(Ee,{})]})})},Pe=u.Z.div(kn||(kn=(0,a.Z)(["\n  display: flex;\n  flex: 1;\n  padding: 10px;\n  overflow-x: scroll;\n"]))),Ne=t(2126),Se=t(7099),Fe=t(1333),De=t(8894),ze=function(){return{projectId:Vn()}},Re=function(){return["epics",ze()]},Qe=function(n){var e=function(n){var e=(0,y.i)();return(0,b.useMutation)((function(n){return e("epics",{method:"POST",data:n})}),S(n))}(Re()),t=e.mutate,r=e.isLoading,i=(0,Me.cI)(),o=(0,c.Z)(i,1)[0],a=Vn(),u=function(){var e=(0,w.Z)((0,I.Z)().mark((function e(r){return(0,I.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,t((0,l.Z)((0,l.Z)({},r),{},{projectId:a}));case 2:n.onClose();case 3:case"end":return e.stop()}}),e)})));return function(n){return e.apply(this,arguments)}}();return(0,C.jsx)(De.Z,{visible:n.visible,onClose:n.onClose,forceRender:!0,destroyOnClose:!0,width:"100%",children:(0,C.jsxs)(Ae,{children:[(0,C.jsx)("h1",{children:"\u521b\u5efa\u4efb\u52a1\u7ec4"}),(0,C.jsxs)(G.Z,{form:o,layout:"vertical",style:{width:"40rem"},onFinish:u,children:[(0,C.jsx)(G.Z.Item,{label:"\u540d\u79f0",name:"name",rules:[{required:!0,message:"\u8bf7\u8f93\u5165\u4efb\u52a1\u7ec4\u540d\u79f0"}],children:(0,C.jsx)(J.Z,{placeholder:"\u8bf7\u8f93\u5165\u4efb\u52a1\u7ec4\u540d\u79f0"})}),(0,C.jsx)(G.Z.Item,{children:(0,C.jsx)(Dn.Z,{loading:r,type:"primary",htmlType:"submit",children:"\u63d0\u4ea4"})})]})]})})},Ae=u.Z.div(yn||(yn=(0,a.Z)(["\n  min-height: 80vh;\n  display: flex;\n  flex-direction: column;\n  align-items: center;\n  justify-content: center; \n"]))),Ye=function(){var n=Hn().data,e=function(n){var e=(0,y.i)();return(0,b.useQuery)(["epics",n],(function(){return e("epics",{data:n})}))}(ze()).data,t=Yn({projectId:null===n||void 0===n?void 0:n.id}).data,r=void 0===t?[]:t,i=function(n){var e=(0,y.i)();return(0,b.useMutation)((function(n){var t=n.id;return e("epics/".concat(t),{method:"DELETE"})}),P(n))}(Re()).mutate,o=(0,A.useState)(!1),a=(0,c.Z)(o,2),u=a[0],d=a[1];return(0,C.jsxs)(Q.X_,{children:[(0,C.jsxs)(Q.at,{between:!0,children:[(0,C.jsxs)("h1",{children:[null===n||void 0===n?void 0:n.name,"\u4efb\u52a1\u7ec4"]}),(0,C.jsx)(Dn.Z,{onClick:function(){return d(!0)},children:"\u521b\u5efa\u4efb\u52a1\u7ec4"})]}),(0,C.jsx)(Ne.ZP,{style:{overflow:"scroll "},dataSource:e,itemLayout:"vertical",renderItem:function(e){return(0,C.jsxs)(Ne.ZP.Item,{children:[(0,C.jsx)(Ne.ZP.Item.Meta,{title:(0,C.jsxs)(Q.at,{between:!0,children:[(0,C.jsx)("span",{children:e.name}),(0,C.jsx)(Dn.Z,{type:"link",onClick:function(){return function(n){p.Z.confirm({title:"\u786e\u5b9a\u5220\u9664\u4efb\u52a1\u7ec4: ".concat(n.name,"?"),okText:"\u786e\u5b9a",cancelText:"\u53d6\u6d88",onOk:function(){i({id:n.id})}})}(e)},children:"\u5220\u9664"})]}),description:(0,C.jsxs)("div",{children:[(0,C.jsxs)("div",{children:["\u5f00\u59cb\u65f6\u95f4\uff1a",m()(e.start).format("YYYY-MM-DD")]}),(0,C.jsxs)("div",{children:["\u7ed3\u675f\u65f6\u95f4\uff1a",m()(e.end).format("YYYY-MM-DD")]})]})}),(0,C.jsx)(Se.Z,{children:r.filter((function(n){return n.epicId===e.id})).map((function(e,t,r){return(0,C.jsxs)("div",{children:[(0,C.jsx)(Z.rU,{to:"/projects/".concat(null===n||void 0===n?void 0:n.id,"/kanban?editingTaskId=").concat(e.id),children:e.name}),t<r.length-1?(0,C.jsx)(Fe.Z,{type:"vertical"}):null]},e.id)}))})]})}}),(0,C.jsx)(Qe,{visible:u,onClose:function(){return d(!1)}})]})},We=[{label:(0,C.jsx)(Z.rU,{to:"kanban",children:"\u770b\u677f"}),key:"kanban"},{label:(0,C.jsx)(Z.rU,{to:"epic",children:"\u4efb\u52a1\u7ec4"}),key:"epic"}],Ve=function(){var n=function(){var n=(0,zn.TH)().pathname.split("/");return n[n.length-1]}();return(0,C.jsxs)(Ue,{children:[(0,C.jsx)(He,{children:(0,C.jsx)(h.Z,{items:We,mode:"inline",selectedKeys:[n]})}),(0,C.jsx)(Ke,{children:(0,C.jsxs)(zn.Z5,{children:[(0,C.jsx)(zn.AW,{path:"/kanban",element:(0,C.jsx)(Te,{})}),(0,C.jsx)(zn.AW,{path:"/epic",element:(0,C.jsx)(Ye,{})}),(0,C.jsx)(zn.AW,{path:"/",element:(0,C.jsx)(zn.Fg,{to:"kanban",replace:!0})})]})})]})},He=u.Z.div(bn||(bn=(0,a.Z)(["\n  background-color: rgba(244, 245, 247);\n  display: flex;\n"]))),Ke=u.Z.div(Ln||(Ln=(0,a.Z)(["\n  display: flex;\n  overflow: hidden;\n"]))),Ue=u.Z.div(In||(In=(0,a.Z)(["\n  display: grid;\n  grid-template-columns: 16rem 1fr;\n  flex: 1;\n  overflow: hidden;\n"]))),qe=function(){var n=q(),e=n.projectModelOpen,t=n.editingProjectData,r=n.close,i=n.isFetching,o=(t?D:z)(U()),a=o.mutateAsync,u=o.error,d=o.isLoading,s=(0,Me.cI)(),f=(0,c.Z)(s,1)[0],p=function(){f.resetFields(),r()},x=t?"\u7f16\u8f91\u9879\u76ee":"\u521b\u5efa\u9879\u76ee";return(0,A.useEffect)((function(){f.setFieldsValue(t)}),[t,f]),(0,C.jsx)(De.Z,{visible:e,width:"100%",onClose:r,forceRender:!0,children:(0,C.jsx)(Be,{children:i?(0,C.jsx)(Rn.Z,{size:"large"}):(0,C.jsxs)(C.Fragment,{children:[(0,C.jsx)("h1",{children:x}),(0,C.jsx)(Q.Tv,{error:u}),(0,C.jsxs)(G.Z,{form:f,layout:"vertical",style:{width:"40rem"},onFinish:function(n){a((0,l.Z)((0,l.Z)({},t),n)).then(p)},children:[(0,C.jsx)(G.Z.Item,{label:"\u540d\u79f0",name:"name",rules:[{required:!0,message:"\u8bf7\u8f93\u5165\u9879\u76ee\u540d\u79f0"}],children:(0,C.jsx)(J.Z,{placeholder:"\u8bf7\u8f93\u5165\u9879\u76ee\u540d\u79f0"})}),(0,C.jsx)(G.Z.Item,{label:"\u90e8\u95e8",name:"organization",rules:[{required:!0,message:"\u8bf7\u8f93\u5165\u90e8\u95e8\u540d\u79f0"}],children:(0,C.jsx)(J.Z,{placeholder:"\u8bf7\u8f93\u5165\u90e8\u95e8\u540d\u79f0"})}),(0,C.jsx)(G.Z.Item,{label:"\u8d1f\u8d23\u4eba",name:"personId",children:(0,C.jsx)(on,{defaultOptionName:"\u8d1f\u8d23\u4eba"})}),(0,C.jsx)(G.Z.Item,{children:(0,C.jsx)(Dn.Z,{loading:d,type:"primary",htmlType:"submit",children:"\u63d0\u4ea4"})})]})]})})})},Be=u.Z.div(wn||(wn=(0,a.Z)(["\n  min-height: 80vh;\n  display: flex;\n  flex-direction: column;\n  align-items: center;\n  justify-content: center;\n"]))),_e=t(3020),Xe=function(){var n=F({}),e=n.data,t=(n.refetch,q().open),r=null===e||void 0===e?void 0:e.filter((function(n){return n.pin})),i=(0,C.jsxs)(Ge,{children:[(0,C.jsx)(ae.Z.Text,{type:"secondary",children:"\u6536\u85cf\u9879\u76ee"}),(0,C.jsx)(Ne.ZP,{children:null===r||void 0===r?void 0:r.map((function(n){return(0,C.jsx)(Ne.ZP.Item,{children:(0,C.jsx)(Ne.ZP.Item.Meta,{title:n.name})},n.id)}))}),(0,C.jsx)(Fe.Z,{}),(0,C.jsx)(Q.zL,{type:"link",onClick:t,children:"\u521b\u5efa\u9879\u76ee"})]});return(0,C.jsx)(_e.Z,{placement:"bottom",content:i,children:(0,C.jsx)("h3",{style:{cursor:"pointer"},children:"\u9879\u76ee"})})},Ge=u.Z.div(Mn||(Mn=(0,a.Z)(["\n  min-width: 30rem;\n"]))),Je=function(){var n=$(),e=n.data,t=n.refetch,r=(0,C.jsxs)($e,{children:[(0,C.jsx)(ae.Z.Text,{type:"secondary",children:"\u7ec4\u5458\u5217\u8868"}),(0,C.jsx)(Ne.ZP,{children:null===e||void 0===e?void 0:e.map((function(n){return(0,C.jsx)(Ne.ZP.Item,{children:(0,C.jsx)(Ne.ZP.Item.Meta,{title:n.name})},n.id)}))})]});return(0,C.jsx)(_e.Z,{onVisibleChange:function(n){n&&t()},placement:"bottom",content:r,children:(0,C.jsx)("h3",{style:{cursor:"pointer"},children:"\u7ec4\u5458"})})},$e=u.Z.div(En||(En=(0,a.Z)(["\n  min-width: 30rem;\n"]))),nt=t(7962);function et(){return(0,C.jsx)(rt,{children:(0,C.jsxs)(Z.VK,{children:[(0,C.jsx)(tt,{}),(0,C.jsx)(ut,{children:(0,C.jsxs)(zn.Z5,{children:[(0,C.jsx)(zn.AW,{path:"/projects",element:(0,C.jsx)(ln,{})}),(0,C.jsx)(zn.AW,{path:"/projects/:projectId/*",element:(0,C.jsx)(Ve,{})}),(0,C.jsx)(zn.AW,{path:"/",element:(0,C.jsx)(zn.Fg,{to:"/projects",replace:!0})})]})}),(0,C.jsx)(qe,{})]})})}var tt=function(){var n=(0,d.a)(),e=n.logout,t=n.user,r=[{label:"\u767b\u51fa",key:"logout",icon:(0,C.jsx)(nt.Z,{}),onClick:function(){return e()}}];return(0,C.jsxs)(it,{between:!0,children:[(0,C.jsxs)(ot,{gap:!0,children:[(0,C.jsx)(Q.zL,{type:"link",onClick:W,children:(0,C.jsx)(Fn,{width:"18rem",color:"rgb(30, 132, 255)"})}),(0,C.jsx)(Xe,{}),(0,C.jsx)(Je,{})]}),(0,C.jsx)(at,{children:(0,C.jsx)(x.Z,{overlay:(0,C.jsx)(h.Z,{items:r}),children:(0,C.jsxs)(Dn.Z,{type:"link",onClick:function(n){return n.preventDefault()},children:["Hi, ",null===t||void 0===t?void 0:t.name]})})})]})},rt=u.Z.div(On||(On=(0,a.Z)(["\n  display: grid;\n  grid-template-rows: 6rem 1fr;\n  height: 100vh;\n"]))),it=(0,u.Z)(Q.at)(Tn||(Tn=(0,a.Z)(["\n  padding: 3.2rem;\n  box-shadow: 0 0 5px 0 rgba(0, 0, 0, 0.1);\n  z-index: 1;\n"]))),ot=(0,u.Z)(Q.at)(Pn||(Pn=(0,a.Z)([""]))),at=u.Z.div(Nn||(Nn=(0,a.Z)([""]))),ut=u.Z.main(Sn||(Sn=(0,a.Z)(["\n  display: flex;\n  flex-direction: column;\n  overflow: hidden;\n"])))}}]);
//# sourceMappingURL=675.15e4781b.chunk.js.map